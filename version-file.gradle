task versionFile() {
    dependsOn "processResources"

    doLast {
        def stdout = new ByteArrayOutputStream()
        exec {
            commandLine 'git', 'show', '--summary', '--no-color'
            standardOutput = stdout
        }
        def lines = stdout.toString().trim().split("\n")

        stdout = new ByteArrayOutputStream()
        exec {
            commandLine 'git', 'status', '--short'
            standardOutput = stdout
        }
        def dirty = ""
        if (!stdout.toString().trim().isEmpty()) {
            dirty = " - dirty"
        }

        def result = []

        result += lines[0].substring(lines[0].indexOf(' '), lines[0].indexOf(' ') + 12).trim() + dirty
        result += lines[2].substring(lines[2].indexOf(' ')).trim()
        result += lines.drop(3).findAll {
            !it.trim().isEmpty()
        }.collect {
            it.trim()
        }

        file("$buildDir/processedResources/Js/main/version").text = result.join("\n")
    }
}
